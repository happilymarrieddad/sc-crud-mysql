"use strict";var router=new VueRouter,aboutComponent=Vue.extend({template:templatizer.about.index({}),data:function(){return{ready:!1}},methods:{fetchData:function(t){t&&"function"==typeof t&&t(null)}},ready:function(){},route:{data:function(t){var e=this;e.fetchData(function(o){o?(e.$root.alert(o,"error"),router.go("/")):(e.ready=!0,t.next())})},waitForData:!0}}),dashboardComponent=Vue.extend({template:templatizer.dashboard.index({}),data:function(){return{ready:!1}},methods:{fetchData:function(t){t&&"function"==typeof t&&t(null)}},ready:function(){},route:{data:function(t){var e=this;e.fetchData(function(o){o?(e.$root.alert(o,"error"),router.go("/")):(e.ready=!0,t.next())})},waitForData:!0}}),sessionCreateComponent=Vue.extend({template:templatizer.session.create({}),data:function(){return{email:"",password:"",ready:!1}},methods:{login:function(){var t=this;validate.async({email:t.email,password:t.password},{email:{presence:!0},password:{presence:!0}}).then(function(e){t.$root.$sc.emit("session",{method:"store",email:e.email,password:e.password},function(e){if(e)return console.log(e),t.$root.alert(e,"error")})},function(e){var o=null;for(var r in e){o=e[r][0];break}t.$root.alert(o,"error")})}},ready:function(){},route:{data:function(t){var e=this;e.ready=!0,t.next()}}}),usersCreateComponent=Vue.extend({template:templatizer.users.create({}),data:function(){return{first:"",last:"",email:"",password:"",ready:!1}},methods:{fetchData:function(t){t&&"function"==typeof t&&t(null)},clearFields:function(){this.first="",this.last="",this.email="",this.password=""},create:function(){var t=this;validate.async({first:t.first,last:t.last,email:t.email,password:t.password,visible:1},{first:{presence:!0},last:{presence:!0},email:{presence:!0},password:{presence:!0}}).then(function(e){t.$root.$sc.emit("create",{table:"users",post:e},function(e,o){return e?t.$root.alert(e,"error"):(t.$root.alert("Successfully created account "+o.email+"! Please log in.","success"),router.go({path:"/session/create"}),void console.log(o))})},function(e){var o=null;for(var r in e){o=e[r][0];break}t.$root.alert(o,"error")})}},ready:function(){},route:{data:function(t){var e=this;e.fetchData(function(o){o?t.abort():(e.ready=!0,e.clearFields(),t.next())})},waitForData:!0}}),usersComponent=Vue.extend({template:templatizer.users.index({}),data:function(){return{users:[],page:1,limit:25,num_users:0,total_users:0,pagination:!1,first:"",last:"",email:"",password:"",confirm_password:"",ready:!1}},watch:{search:function(t,e){this.fetchData(null)}},computed:{num_users:function(){return this.users.length},pagination:function(){return this.total_users>=this.limit}},methods:{delete:function(){},create:function(){},fetchData:function(t,e){var o=this;o.$dispatch("read",{table:"users",limit:o.limit,offset:(o.page-1)*o.limit,search:o.search},function(t,r){return t?o.$root.transitionError(t):e&&"function"==typeof e?e(r):void(o.users=r)})},updateData:function(t){this.users=t}},events:{"users-update":function(t){console.log(t)},"users-destroy":function(t){console.log(t)},"users-store":function(t){console.log(t)}},ready:function(){},route:{data:function(t){var e=this;e.fetchData({},function(e){t.next({ready:!0,users:e})})},waitForData:!0}}),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};Vue.use(VueRouter),Vue.use(VueSocketcluster),router.map({"/dashboard":{component:dashboardComponent,auth:!0},"/about":{component:aboutComponent,auth:!0},"/users":{component:usersComponent,auth:!0},"/session/create":{component:sessionCreateComponent,auth:!1},"/users/create":{component:usersCreateComponent,auth:!1}}),router.redirect({"*":"/dashboard"}),router.beforeEach(function(t){router.app.loading=!0,t.to.auth&&"authenticated"!=router.app.$sc.authState?(router.app.loading=!1,t.redirect("/session/create")):"authenticated"!=router.app.$sc.authState||t.to.auth?t.next():(router.app.loading=!1,t.redirect("/dashboard"))}),router.afterEach(function(t){setTimeout(function(){router.app.loading=!1},router.app.loading_delay)}),router.start(Vue.extend({data:function(){return{loading_delay:20,show_success:!1,success_msg:"",show_error:!1,error_msg:"",started:!1,loading:!0,authenticated:!1,first:"",last:"",email:""}},watch:{authenticated:function(t,e){t?router.go({path:"/dashboard"}):router.go({path:"/session/create"})}},methods:{transitionError:function(t){this.alert(t,"error"),router.go({path:"/dashboard"})},setUserData:function(){var t=this,e=t.$sc.getAuthToken()||{};t.first=e.first,t.last=e.last,t.email=e.email},alert:function(t,e){var o=this;try{o[e+"_msg"]=t,o["show_"+e]=!0,setTimeout(function(){o[e+"_msg"]=null},3e3)}catch(t){}},logout:function(){var t=this;t.$root.$sc.emit("session",{method:"destroy"},function(e){if(e)return console.log(e),t.$root.alert(e,"error")})}},events:{},sockets:{connect:function(t){var e=this;e.authenticated=t.isAuthenticated},authenticate:function(){this.authenticated=!0,this.setUserData()},deauthenticate:function(){this.authenticated=!1},update:function(t,e){var o=this;"object"==("undefined"==typeof t?"undefined":_typeof(t))&&t.table&&o.$broadcast(t.table+"-update",t,e&&"function"==typeof e?e:function(){})},destroy:function(t){var e=this;"object"==("undefined"==typeof t?"undefined":_typeof(t))&&t.table&&e.$broadcast(t.table+"-destroy",t,respond&&"function"==typeof respond?respond:function(){})},store:function(t){var e=this;"object"==("undefined"==typeof t?"undefined":_typeof(t))&&t.table&&e.$broadcast(t.table+"-store",t,respond&&"function"==typeof respond?respond:function(){})}},components:{alert:VueStrap.alert,navbar:VueStrap.navbar},ready:function(){var t=this;t.started=!0}}),"#app");